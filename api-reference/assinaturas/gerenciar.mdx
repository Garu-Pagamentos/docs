---
title: "Gerenciar Assinaturas"
description: "Listar, cancelar, pausar e retomar assinaturas"
api: "GET /api/subscriptions"
---

## Visão Geral

Gerencie o ciclo de vida das assinaturas dos seus clientes: liste assinaturas ativas, cancele, pause ou retome cobranças.

## Listar Assinaturas

Retorna todas as assinaturas do vendedor autenticado.

```bash
curl -X GET "https://api.garu.com.br/api/subscriptions?status=active" \
  -H "Authorization: Bearer sk_test_sua_chave"
```

### Parâmetros de Query

<ParamField query="status" type="string">
  Filtrar por status: `pending`, `active`, `pending_cancellation`, `canceled`, `failed`.
</ParamField>

<ParamField query="customerId" type="integer">
  Filtrar por ID do cliente.
</ParamField>

<ParamField query="productId" type="integer">
  Filtrar por ID do produto.
</ParamField>

### Resposta

```json
{
  "data": [
    {
      "id": 100,
      "uuid": "sub_xyz789",
      "customerId": 50,
      "subscriptionPriceId": 456,
      "status": "active",
      "currentPeriodStart": "2024-02-15T00:00:00.000Z",
      "currentPeriodEnd": "2024-03-15T00:00:00.000Z",
      "trialEndsAt": null,
      "cancelAt": null,
      "lastPaymentAt": "2024-02-15T10:00:00.000Z",
      "nextPaymentAt": "2024-03-15T10:00:00.000Z",
      "customer": {
        "id": 50,
        "name": "João Silva",
        "email": "joao@email.com"
      },
      "subscriptionPrice": {
        "id": 456,
        "name": "Plano Mensal",
        "amount": 4990,
        "billingInterval": "monthly"
      }
    }
  ],
  "count": 1,
  "page": 1,
  "totalPages": 1
}
```

## Buscar Assinatura por ID

```bash
curl -X GET https://api.garu.com.br/api/subscriptions/100 \
  -H "Authorization: Bearer sk_test_sua_chave"
```

### Resposta

```json
{
  "id": 100,
  "uuid": "sub_xyz789",
  "customerId": 50,
  "subscriptionPriceId": 456,
  "sellerId": 1,
  "status": "active",
  "currentPeriodStart": "2024-02-15T00:00:00.000Z",
  "currentPeriodEnd": "2024-03-15T00:00:00.000Z",
  "trialEndsAt": null,
  "cancelAt": null,
  "canceledAt": null,
  "paymentMethod": "credit_card",
  "lastPaymentAt": "2024-02-15T10:00:00.000Z",
  "nextPaymentAt": "2024-03-15T10:00:00.000Z",
  "failedPaymentCount": 0,
  "createdAt": "2024-01-15T10:30:00.000Z",
  "updatedAt": "2024-02-15T10:00:00.000Z"
}
```

## Cancelar Assinatura

### Cancelamento Imediato

O cliente perde acesso imediatamente:

```bash
curl -X POST https://api.garu.com.br/api/subscriptions/100/cancel \
  -H "Authorization: Bearer sk_test_sua_chave" \
  -H "Content-Type: application/json" \
  -d '{
    "cancelImmediately": true,
    "reason": "Cliente solicitou cancelamento"
  }'
```

**Resultado:**
- Status muda para `canceled`
- Acesso revogado imediatamente
- Nenhuma cobrança futura

### Cancelamento Agendado

O cliente mantém acesso até o fim do período pago:

```bash
curl -X POST https://api.garu.com.br/api/subscriptions/100/cancel \
  -H "Authorization: Bearer sk_test_sua_chave" \
  -H "Content-Type: application/json" \
  -d '{
    "cancelImmediately": false,
    "reason": "Cliente optou por não renovar"
  }'
```

**Resultado:**
- Status muda para `pending_cancellation`
- Cliente mantém acesso até `currentPeriodEnd`
- Campo `cancelAt` preenchido com a data de cancelamento
- No fim do período, status muda para `canceled`

### Parâmetros

<ParamField body="cancelImmediately" type="boolean" required>
  `true` = cancelamento imediato, `false` = cancelamento no fim do período.
</ParamField>

<ParamField body="reason" type="string">
  Motivo do cancelamento (opcional, para registro).
</ParamField>

### Resposta

```json
{
  "id": 100,
  "status": "pending_cancellation",
  "cancelAt": "2024-03-15T00:00:00.000Z",
  "message": "Assinatura será cancelada em 2024-03-15"
}
```

## Pausar Assinatura

Pausa temporariamente as cobranças:

```bash
curl -X POST https://api.garu.com.br/api/subscriptions/100/pause \
  -H "Authorization: Bearer sk_test_sua_chave"
```

**Resultado:**
- Cobranças são suspensas
- Cliente pode manter ou perder acesso (depende da sua implementação)
- Use `resume` para retomar

### Resposta

```json
{
  "id": 100,
  "status": "paused",
  "pausedAt": "2024-02-20T10:00:00.000Z",
  "message": "Assinatura pausada com sucesso"
}
```

## Retomar Assinatura

Retoma uma assinatura pausada:

```bash
curl -X POST https://api.garu.com.br/api/subscriptions/100/resume \
  -H "Authorization: Bearer sk_test_sua_chave"
```

**Resultado:**
- Cobranças são retomadas
- Próxima cobrança é agendada

### Resposta

```json
{
  "id": 100,
  "status": "active",
  "nextPaymentAt": "2024-03-20T10:00:00.000Z",
  "message": "Assinatura retomada com sucesso"
}
```

## Histórico de Eventos

Consulte o histórico de eventos de uma assinatura:

```bash
curl -X GET https://api.garu.com.br/api/subscriptions/100/events \
  -H "Authorization: Bearer sk_test_sua_chave"
```

### Resposta

```json
{
  "data": [
    {
      "id": 789,
      "subscriptionId": 100,
      "eventType": "payment_success",
      "eventData": {
        "amount": 4990,
        "transactionId": "tx_abc123",
        "paidAt": "2024-02-15T10:00:00.000Z"
      },
      "createdAt": "2024-02-15T10:00:00.000Z"
    },
    {
      "id": 788,
      "subscriptionId": 100,
      "eventType": "subscription_activated",
      "eventData": {},
      "createdAt": "2024-01-15T10:30:00.000Z"
    },
    {
      "id": 787,
      "subscriptionId": 100,
      "eventType": "subscription_created",
      "eventData": {
        "priceId": 456,
        "trialDays": 7
      },
      "createdAt": "2024-01-08T10:30:00.000Z"
    }
  ]
}
```

### Tipos de Evento

| Tipo | Descrição |
|------|-----------|
| `subscription_created` | Assinatura criada |
| `subscription_activated` | Assinatura ativada |
| `trial_started` | Período de teste iniciado |
| `trial_ended` | Período de teste encerrado |
| `payment_success` | Pagamento bem-sucedido |
| `payment_failed` | Pagamento falhou |
| `subscription_paused` | Assinatura pausada |
| `subscription_resumed` | Assinatura retomada |
| `subscription_canceled` | Assinatura cancelada |

## Exemplo Completo

```javascript
class GaruSubscriptions {
  constructor(apiKey) {
    this.apiKey = apiKey;
    this.baseUrl = 'https://api.garu.com.br/api';
  }

  async request(method, endpoint, data) {
    const response = await fetch(`${this.baseUrl}${endpoint}`, {
      method,
      headers: {
        'Authorization': `Bearer ${this.apiKey}`,
        'Content-Type': 'application/json'
      },
      body: data ? JSON.stringify(data) : undefined
    });
    return response.json();
  }

  // Listar assinaturas ativas
  async listarAtivas() {
    return this.request('GET', '/subscriptions?status=active');
  }

  // Buscar assinatura
  async buscar(id) {
    return this.request('GET', `/subscriptions/${id}`);
  }

  // Cancelar no fim do período
  async cancelarNoFimDoPeriodo(id, motivo) {
    return this.request('POST', `/subscriptions/${id}/cancel`, {
      cancelImmediately: false,
      reason: motivo
    });
  }

  // Cancelar imediatamente
  async cancelarImediatamente(id, motivo) {
    return this.request('POST', `/subscriptions/${id}/cancel`, {
      cancelImmediately: true,
      reason: motivo
    });
  }

  // Pausar
  async pausar(id) {
    return this.request('POST', `/subscriptions/${id}/pause`);
  }

  // Retomar
  async retomar(id) {
    return this.request('POST', `/subscriptions/${id}/resume`);
  }

  // Histórico
  async historico(id) {
    return this.request('GET', `/subscriptions/${id}/events`);
  }
}

// Uso
const garu = new GaruSubscriptions('sk_test_sua_chave');

// Listar assinaturas ativas
const ativas = await garu.listarAtivas();
console.log(`${ativas.data.length} assinaturas ativas`);

// Cancelar uma assinatura no fim do período
await garu.cancelarNoFimDoPeriodo(100, 'Cliente solicitou');
```

## Próximos Passos

<CardGroup cols={2}>
  <Card title="Portal do Cliente" icon="user" href="/api-reference/assinaturas/portal">
    Autoatendimento para assinantes
  </Card>
  <Card title="Webhooks" icon="webhook" href="/api-reference/webhooks">
    Receber notificações de eventos
  </Card>
</CardGroup>
